{"ast":null,"code":"import { WS_CONNECTION_START, WS_CONNECTION_SUCCESS, WS_CONNECTION_ERROR, WS_GET_MESSAGE, WS_SEND_MESSAGE } from '../actions/socket-actions';\nimport { WS_BASE_URL } from '../../constants/constants';\nexport const socketMiddleware = action => {\n  return store => {\n    let socket = null;\n    return next => action => {\n      const {\n        dispatch\n      } = store;\n      const {\n        type,\n        payload\n      } = action;\n      if (type === WS_CONNECTION_START) {\n        socket = new WebSocket(`${WS_BASE_URL}${payload}`);\n      }\n      ;\n      if (socket) {\n        socket.onopen = event => {\n          dispatch({\n            type: WS_CONNECTION_SUCCESS,\n            payload: event\n          });\n        };\n        socket.onerror = event => {\n          dispatch({\n            type: WS_CONNECTION_ERROR,\n            payload: event\n          });\n        };\n        socket.onmessage = event => {\n          const {\n            data\n          } = event;\n          dispatch({\n            type: WS_GET_MESSAGE,\n            payload: data\n          });\n        };\n        socket.onclose = event => {\n          dispatch({\n            type: 'WS_CONNECTION_CLOSED',\n            payload: event\n          });\n        };\n        if (type === WS_SEND_MESSAGE) {\n          const message = action.payload;\n          socket.send(JSON.stringify(message));\n        }\n      }\n      next(action);\n    };\n  };\n};","map":{"version":3,"names":["WS_CONNECTION_START","WS_CONNECTION_SUCCESS","WS_CONNECTION_ERROR","WS_GET_MESSAGE","WS_SEND_MESSAGE","WS_BASE_URL","socketMiddleware","action","store","socket","next","dispatch","type","payload","WebSocket","onopen","event","onerror","onmessage","data","onclose","message","send","JSON","stringify"],"sources":["/Users/reinaka/Documents/untitled folder/_stellar_/react-burger/src/services/middleware/socketMiddleware.ts"],"sourcesContent":["import type { Middleware, MiddlewareAPI } from 'redux';\nimport { AppDispatch } from '../types/thunkTypes';\nimport { RootState } from '../types/thunkTypes';\nimport {\n    WS_CONNECTION_START,\n    WS_CONNECTION_SUCCESS,\n    WS_CONNECTION_ERROR,\n    WS_GET_MESSAGE,\n    WS_SEND_MESSAGE\n} from '../actions/socket-actions';\nimport { socketActions } from '../actions/socket-actions';\nimport { WS_BASE_URL } from '../../constants/constants';\nimport { TSocketActions } from '../actions/socket-actions';\n\nexport const socketMiddleware = (action: TSocketActions): Middleware => {\n    return ((store: MiddlewareAPI<AppDispatch, RootState>) => {\n        let socket: WebSocket | null = null;\n\n    return next => (action: TSocketActions) => {\n        const { dispatch } = store;\n        const { type, payload } = action;\n        if (type === WS_CONNECTION_START) {\n            socket = new WebSocket(`${WS_BASE_URL}${payload}`);\n        };\n\n        if (socket) {\n        socket.onopen = event => {\n            dispatch({ type: WS_CONNECTION_SUCCESS, payload: event });\n        };\n\n        socket.onerror = event => {\n            dispatch({ type: WS_CONNECTION_ERROR, payload: event });\n        };\n\n        socket.onmessage = event => {\n            const { data } = event;\n            dispatch({ type: WS_GET_MESSAGE, payload: data });\n        };\n        \n        socket.onclose = event => {\n            dispatch({ type: 'WS_CONNECTION_CLOSED', payload: event });\n        };\n\n        if (type === WS_SEND_MESSAGE) {\n            const message  = action.payload;\n            socket.send(JSON.stringify(message));\n        }\n    }\n\n    next(action);\n    };\n    }) as Middleware;\n}; "],"mappings":"AAGA,SACIA,mBAAmB,EACnBC,qBAAqB,EACrBC,mBAAmB,EACnBC,cAAc,EACdC,eAAe,QACZ,2BAA2B;AAElC,SAASC,WAAW,QAAQ,2BAA2B;AAGvD,OAAO,MAAMC,gBAAgB,GAAIC,MAAsB,IAAiB;EACpE,OAASC,KAA4C,IAAK;IACtD,IAAIC,MAAwB,GAAG,IAAI;IAEvC,OAAOC,IAAI,IAAKH,MAAsB,IAAK;MACvC,MAAM;QAAEI;MAAS,CAAC,GAAGH,KAAK;MAC1B,MAAM;QAAEI,IAAI;QAAEC;MAAQ,CAAC,GAAGN,MAAM;MAChC,IAAIK,IAAI,KAAKZ,mBAAmB,EAAE;QAC9BS,MAAM,GAAG,IAAIK,SAAS,CAAE,GAAET,WAAY,GAAEQ,OAAQ,EAAC,CAAC;MACtD;MAAC;MAED,IAAIJ,MAAM,EAAE;QACZA,MAAM,CAACM,MAAM,GAAGC,KAAK,IAAI;UACrBL,QAAQ,CAAC;YAAEC,IAAI,EAAEX,qBAAqB;YAAEY,OAAO,EAAEG;UAAM,CAAC,CAAC;QAC7D,CAAC;QAEDP,MAAM,CAACQ,OAAO,GAAGD,KAAK,IAAI;UACtBL,QAAQ,CAAC;YAAEC,IAAI,EAAEV,mBAAmB;YAAEW,OAAO,EAAEG;UAAM,CAAC,CAAC;QAC3D,CAAC;QAEDP,MAAM,CAACS,SAAS,GAAGF,KAAK,IAAI;UACxB,MAAM;YAAEG;UAAK,CAAC,GAAGH,KAAK;UACtBL,QAAQ,CAAC;YAAEC,IAAI,EAAET,cAAc;YAAEU,OAAO,EAAEM;UAAK,CAAC,CAAC;QACrD,CAAC;QAEDV,MAAM,CAACW,OAAO,GAAGJ,KAAK,IAAI;UACtBL,QAAQ,CAAC;YAAEC,IAAI,EAAE,sBAAsB;YAAEC,OAAO,EAAEG;UAAM,CAAC,CAAC;QAC9D,CAAC;QAED,IAAIJ,IAAI,KAAKR,eAAe,EAAE;UAC1B,MAAMiB,OAAO,GAAId,MAAM,CAACM,OAAO;UAC/BJ,MAAM,CAACa,IAAI,CAACC,IAAI,CAACC,SAAS,CAACH,OAAO,CAAC,CAAC;QACxC;MACJ;MAEAX,IAAI,CAACH,MAAM,CAAC;IACZ,CAAC;EACD,CAAC;AACL,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}